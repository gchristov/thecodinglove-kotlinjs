FROM nginx:1.25.3

ARG APP_SERVICE_HOST
ARG APP_SERVICE_PATH
ARG STATISTICS_SERVICE_HOST
ARG STATISTICS_SERVICE_PATH
ARG SELF_DESTRUCT_SERVICE_HOST
ARG SELF_DESTRUCT_SERVICE_PATH
ARG SLACK_SERVICE_HOST
ARG SLACK_SERVICE_PATH
ARG SLACK_SERVICE_PUBSUB_PATH
# Need to forward the nginx env variables manually for production. Locally we use Docker Compose which does this automatically.
ENV APP_SERVICE_HOST=${APP_SERVICE_HOST}
ENV APP_SERVICE_PATH=${APP_SERVICE_PATH}
ENV STATISTICS_SERVICE_HOST=${STATISTICS_SERVICE_HOST}
ENV STATISTICS_SERVICE_PATH=${STATISTICS_SERVICE_PATH}
ENV SELF_DESTRUCT_SERVICE_HOST=${SELF_DESTRUCT_SERVICE_HOST}
ENV SELF_DESTRUCT_SERVICE_PATH=${SELF_DESTRUCT_SERVICE_PATH}
ENV SLACK_SERVICE_HOST=${SLACK_SERVICE_HOST}
ENV SLACK_SERVICE_PATH=${SLACK_SERVICE_PATH}
ENV SLACK_SERVICE_PUBSUB_PATH=${SLACK_SERVICE_PUBSUB_PATH}

COPY ./default.conf.template /etc/nginx/templates/default.conf.template
COPY ./bin/ /usr/share/nginx/html
